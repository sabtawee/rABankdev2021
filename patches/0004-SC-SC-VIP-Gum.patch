From e68a5be51a7408777391f8f91cf96b370e84195a Mon Sep 17 00:00:00 2001
From: cosmic_traveler <dechavd@hotmail.com>
Date: Thu, 2 Jun 2022 20:17:52 +0700
Subject: [PATCH 4/4] =?UTF-8?q?=E0=B9=80=E0=B8=9E=E0=B8=B4=E0=B9=88?=
 =?UTF-8?q?=E0=B8=A1=20SC=20=E0=B8=95=E0=B9=88=E0=B8=B2=E0=B8=87=E0=B9=86?=
 =?UTF-8?q?=20/=20SC=20VIP=20/=20Gum=20=E0=B8=94=E0=B8=A3=E0=B8=AD?=
 =?UTF-8?q?=E0=B8=9B=E0=B9=80=E0=B8=89=E0=B8=9E=E0=B8=B2=E0=B8=B0?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 db/pre-re/status.yml             | 108 +++++++++++++++++++++++++++++++
 npc/pre-re/scripts_athena.conf   |   4 ++
 npc/pre-re/system/boost_shop.txt |  56 ++++++++++++++++
 npc/pre-re/system/exp_book.txt   |  99 ++++++++++++++++++++++++++++
 src/map/atcommand.cpp            |  33 ++++++++++
 src/map/mob.cpp                  |  32 ++++++++-
 src/map/pc.cpp                   |  47 ++++++++++++++
 src/map/script.cpp               |  18 ++++++
 src/map/script_constants.hpp     |  38 +++++++++++
 src/map/status.cpp               |  14 ++++
 src/map/status.hpp               |  38 +++++++++++
 11 files changed, 486 insertions(+), 1 deletion(-)
 create mode 100644 npc/pre-re/system/boost_shop.txt
 create mode 100644 npc/pre-re/system/exp_book.txt

diff --git a/db/pre-re/status.yml b/db/pre-re/status.yml
index 7bf95b5..287711a 100644
--- a/db/pre-re/status.yml
+++ b/db/pre-re/status.yml
@@ -6921,3 +6921,111 @@ Body:
       NoDispell: true
       NoClearance: true
       NoClearbuff: true
+  - Status: EXPBOOK_DROP
+    Icon: EFST_EXPBOOK_DROP
+    Flags:
+      NoRemoveOnDead: true
+      NoClearbuff: true
+      NoDispell: true
+      NoBanishingBuster: true
+      NoClearance: true
+      SendVal1: true
+  - Status: VIPSTATUS
+    Icon: EFST_VIPSTATUS
+    Flags:
+      NoRemoveOnDead: true
+      NoClearbuff: true
+      NoDispell: true
+      NoBanishingBuster: true
+      NoClearance: true
+      SendVal1: true
+  - Status: EXTRABOOST_EXP
+    Icon: EFST_EXTRABOOST_EXP
+    Flags:
+      NoRemoveOnDead: true
+      NoClearbuff: true
+      NoDispell: true
+      NoBanishingBuster: true
+      NoClearance: true
+      SendVal1: true
+  - Status: EXTRABOOST_DROP
+    Icon: EFST_EXTRABOOST_DROP
+    Flags:
+      NoRemoveOnDead: true
+      NoClearbuff: true
+      NoDispell: true
+      NoBanishingBuster: true
+      NoClearance: true
+      SendVal1: true
+  - Status: GLOBAL_EXP
+    Icon: EFST_GLOBAL_EXP
+    Flags:
+      NoRemoveOnDead: true
+      NoClearbuff: true
+      NoDispell: true
+      NoBanishingBuster: true
+      NoClearance: true
+      SendVal1: true
+  - Status: GLOBAL_DROP
+    Icon: EFST_GLOBAL_DROP
+    Flags:
+      NoRemoveOnDead: true
+      NoClearbuff: true
+      NoDispell: true
+      NoBanishingBuster: true
+      NoClearance: true
+      SendVal1: true
+  - Status: CARDBOOST
+    Icon: EFST_CARDBOOST
+    Flags:
+      NoRemoveOnDead: true
+      NoClearbuff: true
+      NoDispell: true
+      NoBanishingBuster: true
+      NoClearance: true
+      SendVal1: true
+  - Status: EXTRABOOST_HEALING
+    Icon: EFST_EXTRABOOST_HEALING
+    Flags:
+      NoRemoveOnDead: true
+      NoClearbuff: true
+      NoDispell: true
+      NoBanishingBuster: true
+      NoClearance: true
+      SendVal1: true
+  - Status: EXTRABOOST_USABLE
+    Icon: EFST_EXTRABOOST_USABLE
+    Flags:
+      NoRemoveOnDead: true
+      NoClearbuff: true
+      NoDispell: true
+      NoBanishingBuster: true
+      NoClearance: true
+      SendVal1: true
+  - Status: EXTRABOOST_ETC
+    Icon: EFST_EXTRABOOST_ETC
+    Flags:
+      NoRemoveOnDead: true
+      NoClearbuff: true
+      NoDispell: true
+      NoBanishingBuster: true
+      NoClearance: true
+      SendVal1: true
+  - Status: EXTRABOOST_EQUIPMENT
+    Icon: EFST_EXTRABOOST_EQUIPMENT
+    Flags:
+      NoRemoveOnDead: true
+      NoClearbuff: true
+      NoDispell: true
+      NoBanishingBuster: true
+      NoClearance: true
+      SendVal1: true
+  - Status: EXTRABOOST_CARD
+    Icon: EFST_EXTRABOOST_CARD
+    Flags:
+      NoRemoveOnDead: true
+      NoClearbuff: true
+      NoDispell: true
+      NoBanishingBuster: true
+      NoClearance: true
+      SendVal1: true
\ No newline at end of file
diff --git a/npc/pre-re/scripts_athena.conf b/npc/pre-re/scripts_athena.conf
index 38f3165..62d673a 100644
--- a/npc/pre-re/scripts_athena.conf
+++ b/npc/pre-re/scripts_athena.conf
@@ -98,3 +98,7 @@ npc: npc/pre-re/quests/quests_nameless.txt
 npc: npc/pre-re/quests/quests_niflheim.txt
 npc: npc/pre-re/quests/the_sign_quest.txt
 npc: npc/pre-re/quests/quests_veins.txt
+
+// custom system
+npc: npc/pre-re/system/exp_book.txt
+npc: npc/pre-re/system/boost_shop.txt
\ No newline at end of file
diff --git a/npc/pre-re/system/boost_shop.txt b/npc/pre-re/system/boost_shop.txt
new file mode 100644
index 0000000..3210ac9
--- /dev/null
+++ b/npc/pre-re/system/boost_shop.txt
@@ -0,0 +1,56 @@
+prt_fild08,180,355,3	script	Boost Shop	112,{
+	
+	mes .npcname$;
+	mes "เลือก Boost ที่ท่านต้องการ";
+
+	for(.@i=0; .@i<getarraysize(.sc_name$); .@i++){
+		set .@sc_menu$, .@sc_menu$ + " ^FF0000^000000 " + .sc_name$[.@i] + "^000000 [^ff03ab" + .sc_rate[.@i] + "CP^000000/^0307ff1%^000000]:";
+	}
+	set .@sc_sel, select(.@sc_menu$) - 1;	
+	
+	mes "Boost ที่เลือก : ^000dff" + .sc_name$[.@sc_sel] + "^000000 [^ff03ab" + .sc_rate[.@sc_sel] + "CP^000000/^0307ff1%^000000]";
+	input .@pc_want_number,0,20;
+	
+	if(.@pc_want_number == 0){
+		mes "เลขที่ระบุผิดพลาด";
+		end;
+	}
+	
+	if(.@pc_want_number >= 20){
+		mes "ไม่สามารถระบุเกิน 20% ได้";
+		end;
+	}
+	
+	mes "ต้องการบัฟ : ^ff0303" + .@pc_want_number + "^000000%";
+	
+	.@total_cp = .sc_rate[.@sc_sel] * .@pc_want_number;
+	
+	mes "CP ที่ต้องจ่าย : ^0515ff" + .@total_cp + "^000000 CP";
+	
+	if(#CRYPTOPOINTS < .@total_cp){
+		mes "คุณที่ CP พ้อยท์ไม่เพียงพอ";
+		end;
+	}
+	
+	menu "^FF0000^000000 ยืนยัน ",-,"^FF0000^000000 ยกเลิก",-;
+	set .@menu2,@menu;
+	
+	if(.@menu2 == 2) {end;}
+	
+	#CRYPTOPOINTS -= .@total_cp;
+	sc_start .sc_real[.@sc_sel],1800000,.@pc_want_number;
+	specialeffect2 100;
+	end;	
+	
+Oninit:
+
+	.npcname$ = "[^FF0000^000000 ^2f00ffBoost Shop^000000 ^FF0000^000000]";
+	
+	setarray .sc_name$[0],"ดรอปปั้ม","ดรอปของกดใช้","ดรอปขยะ","ดรอปอุปกรณ์สวมใส่","ดรอปการ์ด";
+	setarray .sc_real[0],SC_EXTRABOOST_HEALING,SC_EXTRABOOST_USABLE,SC_EXTRABOOST_ETC,SC_EXTRABOOST_EQUIPMENT,SC_EXTRABOOST_CARD;
+	setarray .sc_rate[0],2,1,1,3,5;	
+
+	waitingroom "ขาย Boost ต่างๆ",0;
+	end;	
+	
+}
\ No newline at end of file
diff --git a/npc/pre-re/system/exp_book.txt b/npc/pre-re/system/exp_book.txt
new file mode 100644
index 0000000..7fb499d
--- /dev/null
+++ b/npc/pre-re/system/exp_book.txt
@@ -0,0 +1,99 @@
+////////////////////////////////////////////////////////////////////////////////////////
+////-- Whispering Rain
+
+function	script	F_EXPBOOK	{
+	doevent "exp_book_CONTROL::OnMenu";
+	end;
+}
+
+-	script	exp_book_CONTROL	-1,{
+
+OnMenu:
+	mes	.npcname$;
+	mes "EXP ตัวละคร : ^ff0000" + (100-exp_book_split) + "^000000%";
+	mes "EXP หนังสือ : ^ff0000" + exp_book_split + "^000000%";
+	mes "EXP ที่มี : ^030ffc" + exp_book + "^000000/^bf5000" + $@exp_limit + "^000000";
+	mes "DROP ถาวร : ^ff0000" + exp_book_drop + "^000000%";
+
+	menu "^FF0000^000000 [ ^1100ffปรับแต่งการเก็บ EXP^000000 ]",-,"^FF0000^000000 [ ^1100ffแลกรางวัล^000000 ]",-,"^FF0000^000000 [ ปิด ]",-;
+	set .@menu_selected,@menu;
+
+	if(.@menu_selected == 1){
+		mes "------------------------";
+		mes "โปรดระบุ % 0 - 100";
+		mes "เพื่อทำการแบ่งเก็บเข้าสมุด";
+		input .@input_numb,0,100;
+		next;
+		mes	.npcname$;
+		mes "EXP ตัวละคร : ^ff0000" + (100-exp_book_split) + "^000000%";
+		mes "EXP หนังสือ : ^ff0000" + exp_book_split + "^000000%";
+		mes "------------------------";
+		mes "คุณต้องการแบ่ง EXP ^ff0000" + .@input_numb + "^000000%";
+		mes "เพื่อเก็บเข้าสมุดใช่หรือไม่?";
+		menu "^FF0000^000000 ตกลง",-,"^FF0000^000000 ยกเลิก",-;
+		set .@confirm,@menu;
+		next;
+		if(.@confirm == 2){end;}
+		if(.@confirm == 1){
+			exp_book_split = .@input_numb;
+			mes	.npcname$;
+			mes "EXP ตัวละคร : ^ff0000" + (100-exp_book_split) + "^000000%";
+			mes "EXP หนังสือ : ^ff0000" + exp_book_split + "^000000%";
+			mes "------------------------";
+			mes "ทำการปรับ % EXP เสร็จสิ้น";
+			end;
+		}
+		end;
+	}
+	if(.@menu_selected == 2){
+		next;
+		mes	.npcname$;
+		mes "EXP ตัวละคร : ^ff0000" + (100-exp_book_split) + "^000000%";
+		mes "EXP หนังสือ : ^ff0000" + exp_book_split + "^000000%";
+		mes "DROP ถาวร : ^ff0000" + exp_book_drop + "^000000%";
+		mes "EXP ที่มี : ^030ffc" + exp_book + "^000000/^bf5000" + $@exp_limit + "^000000";
+		mes "------------------------";
+		menu "^FF0000^000000 Drop ถาวร +1% ^ff0000EXP 50M^000000 [^030ffcMax 10%^000000]",-,"^FF0000^000000 ยกเลิก",-;
+		set .@sel,@menu;
+		if(.@sel == 1){
+			if(exp_book < 50000000){
+				mes	.npcname$;
+				mes "EXP ไม่เพียงพอในการแลก";
+				end;				
+			}			
+			if(exp_book_drop >= 10){
+				mes	.npcname$;
+				mes "ไม่สามารถแลกได้มากกว่าแล้ว";
+				end;
+			}
+			next;
+			exp_book_drop++;
+			exp_book -= 50000000;
+			sc_end SC_EXPBOOK_DROP;
+			sc_start SC_EXPBOOK_DROP,INFINITE_TICK,exp_book_drop;
+			mes	.npcname$;
+			mes "EXP ตัวละคร : ^ff0000" + (100-exp_book_split) + "^000000%";
+			mes "EXP หนังสือ : ^ff0000" + exp_book_split + "^000000%";
+			mes "DROP ถาวร : ^ff0000" + exp_book_drop + "^000000%";
+			mes "EXP ที่มี : ^030ffc" + exp_book + "^000000/^bf5000" + $@exp_limit + "^000000";
+			mes "แลกบัฟเสร็จสิ้น";
+			end;
+		}
+		end;
+	}
+	if(.@menu_selected == 3){end;}
+	end;
+
+OnInit:
+	.npcname$ = "[^FF0000^000000 ^2f00ffEXP Book^000000 ^FF0000^000000]";
+	$@exp_limit = 100000000;
+	end;
+
+OnPCLoginEvent:
+	if(exp_book_drop){
+		sc_end SC_EXPBOOK_DROP;
+		sc_start SC_EXPBOOK_DROP,INFINITE_TICK,exp_book_drop;
+	}
+	end;
+
+}
\ No newline at end of file
diff --git a/src/map/atcommand.cpp b/src/map/atcommand.cpp
index eab323f..e5e8249 100644
--- a/src/map/atcommand.cpp
+++ b/src/map/atcommand.cpp
@@ -7702,6 +7702,39 @@ ACMD_FUNC(mobinfo)
 				continue;
 
 			int droprate = mob_getdroprate( &sd->bl, mob, mob->dropitem[i].rate, drop_modifier );
+			
+			if (pc_isvip(sd)) // Display drop rate increase for VIP
+ 				droprate += (droprate * battle_config.vip_drop_increase) / 100;
+				
+			if(item_data->type == IT_CARD && sd->sc.data[SC_CARDBOOST])
+				droprate += droprate * sd->sc.data[SC_CARDBOOST]->val1 /100;
+				
+			if(item_data->type == IT_HEALING && sd->sc.data[SC_EXTRABOOST_HEALING])
+				droprate += droprate * sd->sc.data[SC_EXTRABOOST_HEALING]->val1/ 100;
+			
+			if(item_data->type == IT_USABLE && sd->sc.data[SC_EXTRABOOST_USABLE])
+				droprate += droprate * sd->sc.data[SC_EXTRABOOST_USABLE]->val1/ 100;
+			
+			if(item_data->type == IT_ETC && sd->sc.data[SC_EXTRABOOST_ETC])
+				droprate += droprate * sd->sc.data[SC_EXTRABOOST_ETC]->val1/ 100;
+			
+			if((item_data->type == IT_ARMOR || item_data->type == IT_WEAPON) && sd->sc.data[SC_EXTRABOOST_EQUIPMENT])
+				droprate += droprate * sd->sc.data[SC_EXTRABOOST_EQUIPMENT]->val1/ 100;
+			
+			if(item_data->type == IT_CARD && sd->sc.data[SC_EXTRABOOST_CARD])
+				droprate += droprate * sd->sc.data[SC_EXTRABOOST_CARD]->val1/ 100;
+				
+			if (sd->sc.data[SC_ITEMBOOST])
+				droprate += droprate * sd->sc.data[SC_ITEMBOOST]->val1 / 100;
+					
+			if (sd->sc.data[SC_EXTRABOOST_DROP])
+				droprate += droprate * sd->sc.data[SC_EXPBOOK_DROP]->val1 / 100;
+				
+			if (sd->sc.data[SC_GLOBAL_DROP])
+				droprate += droprate * sd->sc.data[SC_EXPBOOK_DROP]->val1 / 100;
+				
+			if (sd->sc.data[SC_EXPBOOK_DROP])
+				droprate += droprate * sd->sc.data[SC_EXPBOOK_DROP]->val1 / 100;
 
 			if (item_data->slots)
 				sprintf(atcmd_output2, " - %s[%d]  %02.02f%%", item_data->ename.c_str(), item_data->slots, (float)droprate / 100);
diff --git a/src/map/mob.cpp b/src/map/mob.cpp
index 87e37d7..cfc16e1 100644
--- a/src/map/mob.cpp
+++ b/src/map/mob.cpp
@@ -2478,6 +2478,18 @@ int mob_getdroprate(struct block_list *src, std::shared_ptr<s_mob_db> mob, int b
 			if (sd->sc.data[SC_ITEMBOOST])
 				drop_rate_bonus += sd->sc.data[SC_ITEMBOOST]->val1;
 
+			///////////////////////////////////////////////////////////////////
+			/* VIP + Extra SC */
+			if (sd->sc.data[SC_EXTRABOOST_DROP])
+				drop_rate_bonus += sd->sc.data[SC_EXTRABOOST_DROP]->val1;
+
+			if (sd->sc.data[SC_GLOBAL_DROP])
+				drop_rate_bonus += sd->sc.data[SC_GLOBAL_DROP]->val1;
+
+			if (sd->sc.data[SC_EXPBOOK_DROP])
+				drop_rate_bonus += sd->sc.data[SC_EXPBOOK_DROP]->val1;
+			///////////////////////////////////////////////////////////////////
+
 			int cap;
 
 			if (pc_isvip(sd)) { // Increase item drop rate for VIP.
@@ -2797,7 +2809,25 @@ int mob_dead(struct mob_data *md, struct block_list *src, int type)
 				continue;
 			
 			drop_rate = mob_getdroprate(src, md->db, md->db->dropitem[i].rate, drop_modifier);
-
+			
+			if(it->type == IT_CARD && sd->sc.data[SC_CARDBOOST])
+				drop_rate += sd->sc.data[SC_CARDBOOST]->val1;			
+			
+			if (it->type == IT_HEALING && sd->sc.data[SC_EXTRABOOST_HEALING])
+				drop_rate += sd->sc.data[SC_EXTRABOOST_HEALING]->val1;
+				
+			if (it->type == IT_USABLE && sd->sc.data[SC_EXTRABOOST_USABLE])
+				drop_rate += sd->sc.data[SC_EXTRABOOST_USABLE]->val1;
+				
+			if (it->type == IT_ETC && sd->sc.data[SC_EXTRABOOST_ETC])
+				drop_rate += sd->sc.data[SC_EXTRABOOST_ETC]->val1;
+				
+			if ((it->type == IT_ARMOR || it->type == IT_WEAPON) && sd->sc.data[SC_EXTRABOOST_EQUIPMENT])
+				drop_rate += sd->sc.data[SC_EXTRABOOST_EQUIPMENT]->val1;
+				
+			if (it->type == IT_CARD && sd->sc.data[SC_EXTRABOOST_CARD])
+				drop_rate += sd->sc.data[SC_EXTRABOOST_CARD]->val1;			
+			
 			// attempt to drop the item
 			if (rnd() % 10000 >= drop_rate)
 				continue;
diff --git a/src/map/pc.cpp b/src/map/pc.cpp
index 0241b3f..2f5f91f 100644
--- a/src/map/pc.cpp
+++ b/src/map/pc.cpp
@@ -56,6 +56,7 @@
 #include "storage.hpp"
 #include "unit.hpp" // unit_stop_attack(), unit_stop_walking()
 #include "vending.hpp" // struct s_vending
+#include "mapreg.hpp"
 
 using namespace rathena;
 
@@ -7708,6 +7709,17 @@ static void pc_calcexp(struct map_session_data *sd, t_exp *base_exp, t_exp *job_
 		if (battle_config.vip_bm_increase && pc_isvip(sd)) // Increase Battle Manual EXP rate for VIP
 			bonus += (sd->sc.data[SC_EXPBOOST]->val1 / battle_config.vip_bm_increase);
 	}
+	
+///////////////////////////////////////////////////////////////////
+	/* VIP + Extra SC */
+	if (sd->sc.data[SC_EXTRABOOST_EXP]) {
+		bonus += sd->sc.data[SC_EXTRABOOST_EXP]->val1;
+	}
+	
+	if (sd->sc.data[SC_GLOBAL_EXP]) {
+		bonus += sd->sc.data[SC_GLOBAL_EXP]->val1;
+	}
+///////////////////////////////////////////////////////////////////	
 
 	if (*base_exp) {
 		t_exp exp = (t_exp)(*base_exp + ((double)*base_exp * ((bonus + vip_bonus_base) / 100.)));
@@ -7718,6 +7730,17 @@ static void pc_calcexp(struct map_session_data *sd, t_exp *base_exp, t_exp *job_
 	if (sd->sc.data[SC_JEXPBOOST])
 		bonus += sd->sc.data[SC_JEXPBOOST]->val1;
 
+///////////////////////////////////////////////////////////////////
+	/* VIP + Extra SC */
+	if (sd->sc.data[SC_EXTRABOOST_EXP]) {
+		bonus += sd->sc.data[SC_EXTRABOOST_EXP]->val1;
+	}
+	
+	if (sd->sc.data[SC_GLOBAL_EXP]) {
+		bonus += sd->sc.data[SC_GLOBAL_EXP]->val1;
+	}
+///////////////////////////////////////////////////////////////////	
+
 	if (*job_exp) {
 		t_exp exp = (t_exp)(*job_exp + ((double)*job_exp * ((bonus + vip_bonus_job) / 100.)));
 		*job_exp = cap_value(exp, 1, MAX_EXP);
@@ -7747,6 +7770,28 @@ void pc_gainexp_disp(struct map_session_data *sd, t_exp base_exp, t_exp next_bas
 	clif_messagecolor(&sd->bl, color_table[COLOR_LIGHT_GREEN], output, false, SELF);
 }
 
+static t_exp pc_exp_book_split(struct map_session_data *sd,t_exp exp)
+{
+	nullpo_ret(sd);
+
+	if (!exp) return 0;
+
+	int64 percent = pc_readregistry(sd, reference_uid(add_str("exp_book_split"), 0));
+	int64 current_exp = pc_readregistry(sd, reference_uid(add_str("exp_book"), 0));
+
+	if (percent < 100)
+		exp = exp * percent / 100;
+
+	pc_setregistry(sd, reference_uid(add_str("exp_book"), 0), current_exp + exp);
+	int64 after_exp = pc_readregistry(sd, reference_uid(add_str("exp_book"), 0));
+	int64 exp_limit = static_cast<int64>(mapreg_readreg(add_str("$@exp_limit")));
+	if(after_exp > exp_limit){
+		pc_setregistry(sd, reference_uid(add_str("exp_book"), 0), exp_limit);
+	}
+
+	return exp;
+}
+
 /**
  * Give Base or Job EXP to player, then calculate remaining exp for next lvl
  * @param sd Player
@@ -7783,6 +7828,8 @@ void pc_gainexp(struct map_session_data *sd, struct block_list *src, t_exp base_
 	if (!(exp_flag&2))
 		pc_calcexp(sd, &base_exp, &job_exp, src);
 
+	base_exp -= pc_exp_book_split(sd,base_exp);
+
 	nextb = pc_nextbaseexp(sd);
 	nextj = pc_nextjobexp(sd);
 
diff --git a/src/map/script.cpp b/src/map/script.cpp
index e0f2555..13dc94c 100644
--- a/src/map/script.cpp
+++ b/src/map/script.cpp
@@ -25994,6 +25994,21 @@ BUILDIN_FUNC(getjobexp_ratio){
 	return SCRIPT_CMD_SUCCESS;
 }
 
+BUILDIN_FUNC(fakeIcon)
+{
+	TBL_PC* sd = map_charid2sd(script_getnum(st, 2));
+	int icon = script_getnum(st, 3);
+	int time = script_getnum(st, 4);
+	bool state = (script_getnum(st, 5) == 1);
+
+	if (sd == NULL)
+		return SCRIPT_CMD_FAILURE;
+
+	clif_status_change(&sd->bl, icon, state, time, 0, 0, 0);
+
+	return SCRIPT_CMD_SUCCESS;
+}
+
 #include "../custom/script.inc"
 
 // declarations that were supposed to be exported from npc_chat.cpp
@@ -26713,6 +26728,9 @@ struct script_function buildin_func[] = {
 	BUILDIN_DEF(openbank,"?"),
 	BUILDIN_DEF(getbaseexp_ratio, "i??"),
 	BUILDIN_DEF(getjobexp_ratio, "i??"),
+	
+	BUILDIN_DEF(fakeIcon,"iiii"),
+	
 #include "../custom/script_def.inc"
 
 	{NULL,NULL,NULL},
diff --git a/src/map/script_constants.hpp b/src/map/script_constants.hpp
index 79007f6..8a04467 100644
--- a/src/map/script_constants.hpp
+++ b/src/map/script_constants.hpp
@@ -1859,6 +1859,24 @@
 	export_constant(SC_EXTREMITYFIST2);
 #endif
 
+///////////////////////////////////////////////////////////////////
+	/* VIP + Extra SC */
+	export_constant(SC_VIPSTATUS);
+	export_constant(SC_EXTRABOOST_EXP);
+	export_constant(SC_EXTRABOOST_DROP);
+	export_constant(SC_GLOBAL_EXP);	
+	export_constant(SC_GLOBAL_DROP);	
+ 
+	export_constant(SC_EXPBOOK_DROP);	
+	export_constant(SC_CARDBOOST);
+	
+	export_constant(SC_EXTRABOOST_HEALING);
+	export_constant(SC_EXTRABOOST_USABLE);
+	export_constant(SC_EXTRABOOST_ETC);
+	export_constant(SC_EXTRABOOST_EQUIPMENT);
+	export_constant(SC_EXTRABOOST_CARD);	
+///////////////////////////////////////////////////////////////////
+
 	/* status icons */
 	export_deprecated_constant2("SI_BLANK",-1);
 	export_deprecated_constant2("SI_PROVOKE",0);
@@ -4013,6 +4031,26 @@
 	export_constant(EFST_MTP_W_POTION_100);
 /// @APIHOOK_END
 /// Do not modify code above this, since it will be automatically generated by the API again
+
+///////////////////////////////////////////////////////////////////
+	/* VIP + Extra SC */
+	export_constant(EFST_VIPSTATUS);
+	export_constant(EFST_EXTRABOOST_EXP);
+	export_constant(EFST_EXTRABOOST_DROP);
+	export_constant(EFST_GLOBAL_EXP);
+	export_constant(EFST_GLOBAL_DROP);
+	
+	export_constant(EFST_EXPBOOK_DROP);
+	export_constant(EFST_CARDBOOST);
+	
+	export_constant(EFST_EXTRABOOST_HEALING);
+	export_constant(EFST_EXTRABOOST_USABLE);
+	export_constant(EFST_EXTRABOOST_ETC);
+	export_constant(EFST_EXTRABOOST_EQUIPMENT);
+	export_constant(EFST_EXTRABOOST_CARD);	
+	
+///////////////////////////////////////////////////////////////////
+
 	export_constant(EFST_MAX);
 
 	/* elements */
diff --git a/src/map/status.cpp b/src/map/status.cpp
index 2a2eb9c..8d71f6c 100644
--- a/src/map/status.cpp
+++ b/src/map/status.cpp
@@ -10749,9 +10749,23 @@ int status_change_start(struct block_list* src, struct block_list* bl,enum sc_ty
 			val2 *= val1; // 20% per level
 			val3 *= val1;
 			break;
+		case SC_VIPSTATUS:
+			val1 = 0;
+			break;			
 		case SC_EXPBOOST:
 		case SC_JEXPBOOST:
 		case SC_JP_EVENT04:
+		case SC_EXPBOOK_DROP:
+		case SC_EXTRABOOST_EXP:
+		case SC_EXTRABOOST_DROP:
+		case SC_GLOBAL_EXP:
+		case SC_GLOBAL_DROP:		
+		case SC_CARDBOOST:
+		case SC_EXTRABOOST_HEALING:
+		case SC_EXTRABOOST_USABLE:
+		case SC_EXTRABOOST_ETC:
+		case SC_EXTRABOOST_EQUIPMENT:
+		case SC_EXTRABOOST_CARD:
 			if (val1 < 0)
 				val1 = 0;
 			break;
diff --git a/src/map/status.hpp b/src/map/status.hpp
index 8e30bf6..b7b78f8 100644
--- a/src/map/status.hpp
+++ b/src/map/status.hpp
@@ -1193,6 +1193,25 @@ enum sc_type : int16 {
 #ifdef RENEWAL
 	SC_EXTREMITYFIST2, //! NOTE: This SC should be right before SC_MAX, so it doesn't disturb if RENEWAL is disabled
 #endif
+
+//////////////////////////////////////////////////////////////////
+	// VIP + Extra SC
+	SC_VIPSTATUS,
+	SC_EXTRABOOST_EXP,
+	SC_EXTRABOOST_DROP,
+	SC_GLOBAL_EXP,
+	SC_GLOBAL_DROP,
+
+	SC_EXPBOOK_DROP,
+	SC_CARDBOOST,
+	
+	SC_EXTRABOOST_HEALING,
+	SC_EXTRABOOST_USABLE,
+	SC_EXTRABOOST_ETC,
+	SC_EXTRABOOST_EQUIPMENT,
+	SC_EXTRABOOST_CARD,	
+///////////////////////////////////////////////////////////////////
+
 	SC_MAX, //Automatically updated max, used in for's to check we are within bounds.
 };
 
@@ -2551,6 +2570,25 @@ enum efst_type : short{
 	EFST_MTP_W_POTION_100 = 1418,
 /// @APIHOOK_END
 /// Do not modify code above this, since it will be automatically generated by the API again
+
+///////////////////////////////////////////////////////////////////
+	/* VIP + Extra SC */
+	EFST_VIPSTATUS = 1500,
+	EFST_EXTRABOOST_EXP,
+	EFST_EXTRABOOST_DROP,
+	EFST_GLOBAL_EXP,
+	EFST_GLOBAL_DROP,
+	
+	EFST_EXPBOOK_DROP = 1800,
+	EFST_CARDBOOST,
+	
+	EFST_EXTRABOOST_HEALING = 1810,
+	EFST_EXTRABOOST_USABLE,
+	EFST_EXTRABOOST_ETC,
+	EFST_EXTRABOOST_EQUIPMENT,
+	EFST_EXTRABOOST_CARD,	
+///////////////////////////////////////////////////////////////////
+
 	EFST_MAX,
 };
 
-- 
2.36.0.windows.1

